<!DOCTYPE html>
<html class="light" lang="en">
<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>Prediction History</title>

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com?plugins=forms"></script>

  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#0A2540",
            background: "#F8FAFC"
          },
          fontFamily: {
            display: ["Inter", "sans-serif"]
          }
        }
      }
    };
  </script>
</head>

<body class="bg-background text-slate-800 font-display min-h-screen flex flex-col">

<!-- HEADER -->
<header class="bg-white border-b border-slate-200">
  <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
    <div class="flex items-center gap-3">
      <span class="material-symbols-outlined text-primary text-3xl">analytics</span>
      <h1 class="text-xl font-bold text-primary">Prediction History</h1>
    </div>

    <div class="flex gap-3">
      <button onclick="exportCSV()"
        class="flex items-center gap-1 px-4 py-2 rounded-lg border border-slate-300 text-sm hover:bg-slate-50">
        <span class="material-symbols-outlined text-sm">download</span>
        Export CSV
      </button>

      <button onclick="clearHistory()"
        class="flex items-center gap-1 px-4 py-2 rounded-lg border border-red-300 text-red-600 text-sm hover:bg-red-50">
        <span class="material-symbols-outlined text-sm">delete</span>
        Clear
      </button>

      <button onclick="location.href='dashboard.html'"
        class="flex items-center gap-1 px-4 py-2 rounded-lg bg-primary text-white text-sm hover:opacity-90">
        Back
      </button>
    </div>
  </div>
</header>

<!-- MAIN -->
<main class="flex-1 max-w-7xl mx-auto px-4 py-6 w-full">

  <div class="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden">
    <div class="overflow-x-auto">
      <table class="w-full text-sm">
        <thead class="bg-slate-50 border-b border-slate-200">
          <tr class="text-left">
            <th class="p-4">No.</th>
            <th class="p-4">Age</th>
            <th class="p-4">Job</th>
            <th class="p-4">Marital</th>
            <th class="p-4 text-right">Balance (€)</th>
            <th class="p-4">Date</th>
            <th class="p-4">Result</th>
            <th class="p-4 text-right">Confidence</th>
          </tr>
        </thead>

        <tbody id="historyTable" class="divide-y divide-slate-200">
          <!-- JS render here -->
        </tbody>
      </table>
    </div>

    <div id="emptyState" class="p-8 text-center text-slate-400 hidden">
      No prediction history found.
    </div>
  </div>

</main>

<footer class="border-t border-slate-200 bg-white py-4 text-center text-xs text-slate-400">
  © 2025 SecureBank Analytics
</footer>

<script>
  const HISTORY_KEY = "prediction_history_v1";
  const tableBody = document.getElementById("historyTable");
  const emptyState = document.getElementById("emptyState");

  const history = JSON.parse(localStorage.getItem(HISTORY_KEY) || "[]");

  function formatDate(iso) {
    const d = new Date(iso);
    return d.toLocaleString();
  }

  function renderHistory() {
    tableBody.innerHTML = "";

    if (history.length === 0) {
      emptyState.classList.remove("hidden");
      return;
    }

    emptyState.classList.add("hidden");

    history.forEach((item, index) => {
      const tr = document.createElement("tr");
      const yes = item.output.pred === 1;

      tr.innerHTML = `
        <td class="p-4 font-semibold">${index + 1}</td>
        <td class="p-4">${item.input.age}</td>
        <td class="p-4 capitalize">${item.input.job}</td>
        <td class="p-4 capitalize">${item.input.marital}</td>
        <td class="p-4 text-right font-mono">${item.input.balance.toLocaleString()}</td>
        <td class="p-4 text-slate-500">${formatDate(item.createdAt)}</td>
        <td class="p-4">
          <span class="px-2 py-1 rounded-full text-xs font-semibold ${
            yes ? "bg-green-100 text-green-700" : "bg-red-100 text-red-700"
          }">
            ${yes ? "Yes" : "No"}
          </span>
        </td>
        <td class="p-4 text-right font-semibold">${item.output.pct}%</td>
      `;

      tableBody.appendChild(tr);
    });
  }

  function clearHistory() {
    if (!confirm("Clear all prediction history?")) return;
    localStorage.removeItem(HISTORY_KEY);
    location.reload();
  }

  function exportCSV() {
    if (history.length === 0) return;

    const header = [
      "No","Age","Job","Marital","Balance","Date","Result","Confidence"
    ];

    const rows = history.map((item, i) => [
      i + 1,
      item.input.age,
      item.input.job,
      item.input.marital,
      item.input.balance,
      item.createdAt,
      item.output.pred === 1 ? "Yes" : "No",
      item.output.pct + "%"
    ]);

    let csv = header.join(",") + "\n";
    rows.forEach(r => csv += r.join(",") + "\n");

    const blob = new Blob([csv], { type: "text/csv" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "prediction_history.csv";
    a.click();
  }

  renderHistory();
</script>

</body>
</html>
